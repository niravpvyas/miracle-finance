<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Miracle Financial Services (Calculator)</title>
  </head>
  <body>
    <div id="pageLoader">
      <div class="loader-spinner"></div>
      <div class="loader-text">Making your financial dreams a reality...</div>
    </div>
    <div id="mainContent" style="display:none;">
      <div class="page-title">‚ú® Miracle Financial Services</div>
      <div class="container">
      <h1 id="mainHeading">EMI Calculator for Home Loan üè†</h1>
      <div class="tabs">
        <button class="tab active" data-loan="home">Home Loan</button>
        <button class="tab" data-loan="personal">Personal Loan</button>
        <button class="tab" data-loan="car">Car Loan</button>
      </div>
      <div class="calculator">
        <div class="row-full">
          <div class="inputs">
            <label
              >Loan Amount
              <input
                type="text"
                id="loanAmount"
                value="1,00,000"
                min="10000"
                max="10000000"
                step="1000"
              />
              ‚Çπ
            </label>
            <input
              type="range"
              id="loanAmountRange"
              value="100000"
              min="10000"
              max="10000000"
              step="1000"
            />
            <div class="slider-ticks" id="loanAmountLabels"></div>
            <label
              >Interest Rate
              <input
                type="number"
                id="interestRate"
                value="9"
                min="1"
                max="20"
                step="0.1"
              />%
            </label>
            <input
              type="range"
              id="interestRateRange"
              value="9"
              min="1"
              max="20"
              step="0.1"
            />
            <div class="slider-ticks" id="interestRateLabels"></div>
            <label
              >Loan Tenure
              <input
                type="number"
                id="loanTenure"
                value="20"
                min="1"
                max="30"
                step="1"
              />Years
            </label>
            <input
              type="range"
              id="loanTenureRange"
              value="20"
              min="1"
              max="30"
              step="1"
            />
            <div class="slider-ticks" id="loanTenureLabels"></div>
          </div>
        </div>
        <div class="row-summary-charts">
          <div class="summary">
            <div>
              <h2>Loan EMI</h2>
              <p id="emiValue">‚Çπ 0</p>
              <div class="value-words" id="emiValueWords">Zero Rupees</div>
            </div>
            <div>
              <h2>Total Interest Payable</h2>
              <p id="totalInterest">‚Çπ 0</p>
              <div class="value-words" id="totalInterestWords">Zero Rupees</div>
            </div>
            <div>
              <h2>Total Payment (Principal + Interest)</h2>
              <p id="totalPayment">‚Çπ 0</p>
              <div class="value-words" id="totalPaymentWords">Zero Rupees</div>
            </div>
          </div>
          <div class="charts">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
      <div class="schedule">
        <h2>EMI Payment Schedule</h2>
        <canvas id="barChart"></canvas>
        <table id="scheduleTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Year</th>
              <th>Principal (A)</th>
              <th>Interest (B)</th>
              <th>Total Payment (A+B)</th>
              <th>Balance</th>
              <th>Loan Paid To Date</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be generated by JS -->
          </tbody>
        </table>
        <button id="downloadPDF">Download PDF</button>
      </div>
    </div>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.css"
    />
    <style>
      #pageLoader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(120deg, #e3f2fd 0%, #fff 100%);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s;
      }
      .loader-spinner {
        border: 6px solid #e0e0e0;
        border-top: 6px solid #1976d2;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin-bottom: 24px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .loader-text {
        font-size: 22px;
        color: #1976d2;
        font-weight: 600;
        font-family: "Segoe UI", "Arial", sans-serif;
        text-align: center;
        letter-spacing: 1px;
        margin-top: 0;
      }
      .page-title {
        text-align: center;
        font-size: 38px;
        font-weight: 700;
        letter-spacing: 2px;
        color: #1976d2;
        margin-top: 24px;
        margin-bottom: 6px;
        font-family: "Segoe UI", "Arial", sans-serif;
        background: linear-gradient(90deg, #e3f2fd 0%, #fff 100%);
        border-radius: 12px;
        box-shadow: 0 2px 12px #e0e0e0;
        padding: 8px 0 6px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }
      /* Modern input section styling */
      .inputs {
        background: #ededed;
        border-radius: 10px;
        padding: 30px 20px 10px 20px;
        margin-bottom: 0;
        box-shadow: 0 2px 8px #e0e0e0;
      }
      .inputs label {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 10px;
        background: none;
      }
      .inputs input[type="number"] {
        font-size: 22px;
        padding: 10px 16px;
        border-radius: 8px 0 0 8px;
        border: 1px solid #ccc;
        background: #fff;
        width: 260px;
        margin-right: 0;
        box-sizing: border-box;
        border-right: none;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      .inputs input[type="text"]#loanAmount {
        font-size: 22px;
        padding: 10px 16px;
        border-radius: 8px 0 0 8px;
        border: 1px solid #ccc;
        background: #fff;
        width: 260px;
        margin-right: 0;
        box-sizing: border-box;
        border-right: none;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      .inputs span {
        font-size: 18px;
        background: #e0e0e0;
        border-radius: 0 8px 8px 0;
        padding: 10px 18px;
        border: 1px solid #ccc;
        border-left: 1px solid #ccc;
        color: #555;
        margin-left: 0;
        position: relative;
        left: 0px;
      }
      .inputs input[type="range"] {
        width: 100%;
        margin-bottom: 0px;
        margin-top: 10px;
        accent-color: #ff9800;
        height: 8px;
        background: #ddd;
        border-radius: 6px;
        outline: none;
        box-shadow: none;
      }
      .inputs input[type="range"]::-webkit-slider-thumb {
        width: 28px;
        height: 28px;
        background: #ff9800;
        border-radius: 50%;
        box-shadow: 0 2px 6px #bbb;
        border: 3px solid #fff;
        cursor: pointer;
        transition: background 0.3s;
      }
      .inputs input[type="range"]::-moz-range-thumb {
        width: 28px;
        height: 28px;
        background: #ff9800;
        border-radius: 50%;
        border: 3px solid #fff;
        cursor: pointer;
      }
      .inputs input[type="range"]::-ms-thumb {
        width: 28px;
        height: 28px;
        background: #ff9800;
        border-radius: 50%;
        border: 3px solid #fff;
        cursor: pointer;
      }
      .slider-ticks {
        display: flex;
        justify-content: space-between;
        position: relative;
        width: 100%;
        margin-bottom: 0px;
        margin-top: 0px;
      }
      .slider-tick {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 1px;
      }
      .slider-tick-mark {
        width: 2px;
        height: 18px;
        background: #888;
        margin-bottom: 0px;
        margin-top: 0px;
      }
      .slider-tick-label {
        font-size: 15px;
        color: #444;
        margin-top: 6px;
        margin-bottom: 0px;
        white-space: nowrap;
      }
      .slider-labels {
        display: flex;
        justify-content: space-between;
        font-size: 16px;
        color: #888;
        margin-bottom: 30px;
        margin-top: 2px;
        font-weight: 500;
      }
      .inputs label + input[type="range"] {
        margin-bottom: 0;
      }
      @media (max-width: 700px) {
        .inputs label {
          font-size: 18px;
        }
        .inputs input[type="number"] {
          font-size: 18px;
          width: 100px;
        }
        .inputs input[type="text"]#loanAmount {
          font-size: 18px;
          width: 100px;
        }
        .inputs span {
          font-size: 16px;
          padding: 8px 10px;
        }
      }
      .row-full {
        width: 100%;
        margin-bottom: 30px;
      }
      .row-summary-charts {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        width: 100%;
        margin-bottom: 30px;
      }
      /* Beautify summary cards */
      .summary > div {
        background: linear-gradient(135deg, #e3f2fd 0%, #fff 100%);
        border-radius: 12px;
        box-shadow: 0 2px 12px #e0e0e0;
        margin-bottom: 18px;
        padding: 18px 16px 10px 16px;
        transition: box-shadow 0.2s;
        border: 1px solid #e0e0e0;
        position: relative;
      }
      .summary > div:hover {
        box-shadow: 0 4px 18px #b3e5fc;
        border-color: #90caf9;
      }
      .summary h2 {
        font-size: 18px;
        margin: 0 0 8px 0;
        color: #1976d2;
        font-weight: 700;
      }
      .summary p {
        font-size: 24px;
        font-weight: bold;
        margin: 0 0 8px 0;
        color: #388e3c;
        letter-spacing: 1px;
      }
      .value-words {
        font-size: 15px;
        color: #ff9800;
        font-weight: 500;
        margin-top: 2px;
        margin-bottom: 0;
        letter-spacing: 0.5px;
        font-style: italic;
        text-shadow: 0 1px 2px #fff3e0;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f7f7f7;
        margin: 0;
      }
      .container {
        max-width: 900px;
        margin: 30px auto;
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px #ccc;
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
      }
      .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }
      .tab {
        padding: 10px 30px;
        border: none;
        background: #eee;
        cursor: pointer;
        font-size: 16px;
        margin: 0 5px;
        border-radius: 5px 5px 0 0;
      }
      .tab.active {
        background: #4285f4;
        color: #fff;
      }
      .calculator {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
      }
      .inputs {
        flex: 2;
        min-width: 250px;
      }
      .inputs label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
      }
      .inputs input[type="number"] {
        width: 120px;
        margin-right: 10px;
      }
      .inputs input[type="range"] {
        width: 100%;
        margin-bottom: 0px;
      }
      .slider-labels {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: #666;
        margin-bottom: 20px;
        margin-top: 2px;
      }
      .summary {
        flex: 1;
        min-width: 200px;
        background: #f2f2f2;
        border-radius: 10px;
        padding: 20px;
      }
      .summary h2 {
        font-size: 16px;
        margin: 10px 0 5px;
      }
      .summary p {
        font-size: 18px;
        font-weight: bold;
        margin: 0 0 15px;
      }
      .charts {
        flex: 1;
        min-width: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .schedule {
        margin-top: 40px;
      }
      #scheduleTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      #scheduleTable th,
      #scheduleTable td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right;
      }
      #scheduleTable th {
        background: #4285f4;
        color: #fff;
      }
      #scheduleTable tbody tr:nth-child(even) {
        background-color: #f7f7f7;
      }
      #scheduleTable tbody tr:nth-child(odd) {
        background-color: #fff;
      }
      #scheduleTable tbody tr:hover {
        background-color: #b8eaf9 !important;
        color: #000101;
      }
      #downloadPDF {
        margin: 20px auto;
        display: block;
        background: #0099ff;
        color: #fff;
        border: none;
        padding: 12px 30px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
      }
      @media (max-width: 700px) {
        .calculator {
          flex-direction: column;
        }
        .charts,
        .summary,
        .inputs {
          min-width: 100%;
        }
      }
    </style>
    <script src="libs/chart.umd.min.js"></script>
    <script src="libs/jspdf.umd.min.js"></script>
    <script src="libs/jspdf.plugin.autotable.min.js"></script>
    <script>
      // Loader logic
      document.addEventListener('DOMContentLoaded', function() {
        window.addEventListener('load', function() {
          var loader = document.getElementById('pageLoader');
          var mainContent = document.getElementById('mainContent');
          if (loader && mainContent) {
            loader.style.opacity = '0';
            setTimeout(function() {
              loader.style.display = 'none';
              mainContent.style.display = '';
            }, 500);
          }
        });
      });
      // EMI Calculator Logic & Chart Integration
      // Helper to create slider labels
      function createSliderLabels(id, min, max, step, formatter, count = 5) {
        const container = document.getElementById(id);
        container.innerHTML = "";
        let values = [];
        if (count === 1) {
          values = [min];
        } else {
          for (let i = 0; i < count; i++) {
            let val = min + ((max - min) * i) / (count - 1);
            if (step >= 1) val = Math.round(val / step) * step;
            values.push(val);
          }
        }
        values.forEach((v) => {
          const span = document.createElement("span");
          span.textContent = formatter(v);
          container.appendChild(span);
        });
      }
      // Helper to create slider ticks
      function createSliderTicks(id, min, max, step, formatter, count = 6) {
        const container = document.getElementById(id);
        container.innerHTML = "";
        let values = [];
        for (let i = 0; i < count; i++) {
          let val = min + ((max - min) * i) / (count - 1);
          if (step >= 1) val = Math.round(val / step) * step;
          values.push(val);
        }
        values.forEach((v) => {
          const tick = document.createElement("div");
          tick.className = "slider-tick";
          const mark = document.createElement("div");
          mark.className = "slider-tick-mark";
          const label = document.createElement("div");
          label.className = "slider-tick-label";
          label.textContent = formatter(v);
          tick.appendChild(mark);
          tick.appendChild(label);
          container.appendChild(tick);
        });
      }

      const loanConfigs = {
        home: { min: 10000, max: 20000000, step: 1000, default: 100000 },
        personal: { min: 10000, max: 1000000, step: 1000, default: 50000 },
        car: { min: 50000, max: 5000000, step: 5000, default: 300000 },
      };

      let currentLoanType = "home";
      let pieChart, barChart;

      function formatINR(num) {
        return "‚Çπ " + num.toLocaleString("en-IN", { maximumFractionDigits: 0 });
      }

      // Helper: Convert number to words (Indian style)
      function numberToWords(num) {
        if (num === 0) return "Zero Rupees";
        const units = ["", "Thousand", "Lakh", "Crore"];
        let n = Math.floor(num);
        let str = "";
        let i = 0;
        while (n > 0 && i < units.length) {
          let part = n % (i === 0 ? 1000 : 100);
          if (part > 0) {
            str =
              part + (units[i] ? " " + units[i] : "") + (str ? ", " + str : "");
          }
          n = Math.floor(n / (i === 0 ? 1000 : 100));
          i++;
        }
        return str + " Rupees";
      }

      function formatAmountAbbr(num) {
        num = Math.round(Number(num));
        if (num >= 10000000) return Math.round(num / 10000000) + "Cr";
        if (num >= 100000) return Math.round(num / 100000) + "L";
        if (num >= 1000) return Math.round(num / 1000) + "K";
        return num.toLocaleString("en-IN");
      }

      function calculateEMI(P, r, n) {
        let monthlyRate = r / 12 / 100;
        let emi =
          (P * monthlyRate * Math.pow(1 + monthlyRate, n)) /
          (Math.pow(1 + monthlyRate, n) - 1);
        return emi;
      }

      function getLoanAmountValue() {
        // Remove commas and parse as number
        const val = document
          .getElementById("loanAmount")
          .value.replace(/,/g, "");
        return Number(val);
      }

      function updateValues() {
        const P = getLoanAmountValue();
        const r = parseFloat(document.getElementById("interestRate").value);
        const years = parseInt(document.getElementById("loanTenure").value);
        const n = years * 12;
        const emi = calculateEMI(P, r, n);
        const totalPayment = emi * n;
        const totalInterest = totalPayment - P;

        document.getElementById("emiValue").textContent = formatINR(
          Math.round(emi)
        );
        document.getElementById("totalInterest").textContent = formatINR(
          Math.round(totalInterest)
        );
        document.getElementById("totalPayment").textContent = formatINR(
          Math.round(totalPayment)
        );

        // Update value-in-words
        document.getElementById("emiValueWords").textContent = numberToWords(
          Math.round(emi)
        );
        document.getElementById("totalInterestWords").textContent =
          numberToWords(Math.round(totalInterest));
        document.getElementById("totalPaymentWords").textContent =
          numberToWords(Math.round(totalPayment));

        updatePieChart(P, totalInterest);
        updateScheduleTable(P, r, years, emi);
        updateBarChart(P, r, years, emi);
      }

      function updatePieChart(principal, interest) {
        const ctx = document.getElementById("pieChart").getContext("2d");
        if (pieChart) pieChart.destroy();
        pieChart = new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["Principal Loan Amount", "Total Interest"],
            datasets: [
              {
                data: [principal, interest],
                backgroundColor: ["#8bc34a", "#ff9800"],
              },
            ],
          },
          options: {
            plugins: {
              legend: { position: "bottom" },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    let label = context.label || "";
                    let value = context.parsed;
                    return `${label}: ‚Çπ ${Number(value).toLocaleString(
                      "en-IN"
                    )}`;
                  },
                },
              },
            },
          },
        });
      }

      function updateBarChart(P, r, years, emi) {
        const ctx = document.getElementById("barChart").getContext("2d");
        if (barChart) barChart.destroy();
        let balance = P;
        let monthlyRate = r / 12 / 100;
        let labels = [];
        let principalData = [];
        let interestData = [];
        let balanceData = [];
        for (let y = 1; y <= years; y++) {
          let yearPrincipal = 0,
            yearInterest = 0;
          for (let m = 1; m <= 12; m++) {
            let interestComp = balance * monthlyRate;
            let principalComp = emi - interestComp;
            yearPrincipal += principalComp;
            yearInterest += interestComp;
            balance -= principalComp;
            if (balance < 0) balance = 0;
          }
          labels.push(new Date().getFullYear() + y - 1);
          principalData.push(Math.round(yearPrincipal));
          interestData.push(Math.round(yearInterest));
          balanceData.push(Math.round(balance));
        }
        barChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels,
            datasets: [
              {
                label: "Principal",
                data: principalData,
                backgroundColor: "#8bc34a",
              },
              {
                label: "Interest",
                data: interestData,
                backgroundColor: "#ff9800",
              },
              {
                label: "Balance",
                data: balanceData,
                type: "line",
                borderColor: "#d32f2f",
                fill: false,
                yAxisID: "y1",
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Amount (‚Çπ)" },
                ticks: {
                  callback: function (value) {
                    return `‚Çπ ${Number(value).toLocaleString("en-IN")}`;
                  },
                },
              },
              y1: {
                beginAtZero: true,
                position: "right",
                grid: { drawOnChartArea: false },
                title: { display: true, text: "Balance (‚Çπ)" },
                ticks: {
                  callback: function (value) {
                    return `‚Çπ ${Number(value).toLocaleString("en-IN")}`;
                  },
                },
              },
            },
            plugins: {
              legend: { position: "bottom" },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    let value =
                      context.parsed.y !== undefined
                        ? context.parsed.y
                        : context.parsed;
                    return `${label}: ‚Çπ ${Number(value).toLocaleString(
                      "en-IN"
                    )}`;
                  },
                },
              },
            },
          },
        });
      }

      function updateScheduleTable(P, r, years, emi) {
        let balance = P;
        let monthlyRate = r / 12 / 100;
        let tbody = document.querySelector("#scheduleTable tbody");
        tbody.innerHTML = "";
        let paidToDate = 0;
        for (let y = 1; y <= years; y++) {
          let yearPrincipal = 0,
            yearInterest = 0;
          for (let m = 1; m <= 12; m++) {
            let interestComp = balance * monthlyRate;
            let principalComp = emi - interestComp;
            yearPrincipal += principalComp;
            yearInterest += interestComp;
            balance -= principalComp;
            if (balance < 0) balance = 0;
          }
          paidToDate += yearPrincipal;
          let percentPaid = ((paidToDate / P) * 100).toFixed(2);
          let row = `<tr>
            <td>${y}</td>
            <td>${new Date().getFullYear() + y - 1}</td>
            <td>${formatINR(Math.round(yearPrincipal))}</td>
            <td>${formatINR(Math.round(yearInterest))}</td>
            <td>${formatINR(Math.round(yearPrincipal + yearInterest))}</td>
            <td>${formatINR(Math.round(balance))}</td>
            <td>${percentPaid}%</td>
          </tr>`;
          tbody.innerHTML += row;
        }
      }

      // Tab switching logic
      const loanTypeInfo = {
        home: { text: "EMI Calculator for Home Loan", emoji: "üè†" },
        personal: { text: "EMI Calculator for Personal Loan", emoji: "üíº" },
        car: { text: "EMI Calculator for Car Loan", emoji: "üöó" },
      };
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
          currentLoanType = this.dataset.loan;
          let config = loanConfigs[currentLoanType];
          document.getElementById("loanAmount").min = config.min;
          document.getElementById("loanAmount").max = config.max;
          document.getElementById("loanAmount").step = config.step;
          document.getElementById("loanAmount").value = Number(
            config.default
          ).toLocaleString("en-IN");
          document.getElementById("loanAmountRange").min = config.min;
          document.getElementById("loanAmountRange").max = config.max;
          document.getElementById("loanAmountRange").step = config.step;
          document.getElementById("loanAmountRange").value = config.default;
          // Update main heading with emoji
          const info = loanTypeInfo[currentLoanType];
          document.getElementById(
            "mainHeading"
          ).textContent = `${info.text} ${info.emoji}`;
          updateValues();
          createSliderTicks(
            "loanAmountLabels",
            config.min,
            config.max,
            config.step,
            (v) => formatAmountAbbr(v),
            6
          );
        });
      });

      // Sync sliders and number inputs
      document
        .getElementById("loanAmount")
        .addEventListener("input", function (e) {
          // Remove all non-digit characters except commas
          let val = this.value.replace(/[^\d]/g, "");
          if (!isNaN(val) && val !== "") {
            let formatted = Number(val).toLocaleString("en-IN");
            this.value = formatted;
            document.getElementById("loanAmountRange").value = val;
            updateValues();
          } else {
            this.value = "";
            document.getElementById("loanAmountRange").value = "";
            updateValues();
          }
        });
      document
        .getElementById("loanAmountRange")
        .addEventListener("input", function () {
          let val = this.value;
          document.getElementById("loanAmount").value =
            Number(val).toLocaleString("en-IN");
          updateValues();
        });
      document
        .getElementById("interestRate")
        .addEventListener("input", function () {
          document.getElementById("interestRateRange").value = this.value;
          updateValues();
        });
      document
        .getElementById("interestRateRange")
        .addEventListener("input", function () {
          document.getElementById("interestRate").value = this.value;
          updateValues();
        });
      document
        .getElementById("loanTenure")
        .addEventListener("input", function () {
          document.getElementById("loanTenureRange").value = this.value;
          updateValues();
        });
      document
        .getElementById("loanTenureRange")
        .addEventListener("input", function () {
          document.getElementById("loanTenure").value = this.value;
          updateValues();
        });

      // PDF Download
      document
        .getElementById("downloadPDF")
        .addEventListener("click", function () {
          const { jsPDF } = window.jspdf;
          let doc = new jsPDF({
            orientation: "portrait",
            unit: "mm",
            format: "a4",
          });
          doc.setFont("helvetica", "bold");
          doc.setFontSize(20);
          doc.text("EMI Calculator Report", 15, 20);
          doc.setFontSize(12);
          doc.setFont("helvetica", "normal");
          doc.text(
            `Loan Type: ${
              currentLoanType.charAt(0).toUpperCase() + currentLoanType.slice(1)
            } Loan`,
            15,
            30
          );
          doc.text(
            `Loan Amount: ${getLoanAmountValue().toLocaleString("en-IN")}`,
            15,
            38
          );
          doc.text(
            `Interest Rate: ${document.getElementById("interestRate").value}%`,
            15,
            46
          );
          doc.text(
            `Tenure: ${document.getElementById("loanTenure").value} years`,
            15,
            54
          );
          doc.setFont("helvetica", "bold");
          doc.text(
            `EMI: ${document.getElementById("emiValue").textContent.replace(/[^\d,.]/g, "")}`,
            15,
            62
          );
          doc.setFont("helvetica", "normal");
          doc.text(
            `Total Interest: ${document.getElementById("totalInterest").textContent.replace(/[^\d,.]/g, "")}`,
            15,
            70
          );
          doc.text(
            `Total Payment: ${document.getElementById("totalPayment").textContent.replace(/[^\d,.]/g, "")}`,
            15,
            78
          );

          // Add summary section
          doc.setFontSize(11);
          doc.setFont("helvetica", "italic");
          doc.text("This report summarizes your loan EMI schedule and total payments.", 15, 86);
          doc.text("Use this table for financial planning and record keeping.", 15, 92);
          doc.setFont("helvetica", "normal");

          // Prepare table data for autoTable, removing '‚Çπ' symbol from all cells
          var tableHeaders = [
            "Year",
            "Calendar Year",
            "Principal (A)",
            "Interest (B)",
            "Total Payment (A+B)",
            "Balance",
            "Loan Paid To Date"
          ];
          var tableRows = Array.from(
            document.querySelectorAll("#scheduleTable tbody tr")
          ).map((tr) => Array.from(tr.children).map((td) => td.textContent.replace(/‚Çπ/g, "").trim()));

          doc.autoTable({
            head: [tableHeaders],
            body: tableRows,
            startY: 105, // Increased space after summary
            theme: 'grid',
            headStyles: { fillColor: [66, 133, 244], textColor: 255, fontStyle: 'bold' },
            styles: { font: 'helvetica', fontSize: 10 },
            margin: { left: 15, right: 15 },
            didDrawPage: function (data) {
              // Optionally add page numbers or other info
            }
          });

          // Duplicate tableHeaders/tableRows and autoTable block removed to fix redeclaration error
          doc.save("EMI_Calculator_Report.pdf");
        });

      // Initial values
      window.onload = function () {
        // Set default heading
        document.getElementById(
          "mainHeading"
        ).textContent = `${loanTypeInfo.home.text} ${loanTypeInfo.home.emoji}`;
        // Initial slider ticks
        createSliderTicks(
          "loanAmountLabels",
          parseInt(document.getElementById("loanAmountRange").min),
          parseInt(document.getElementById("loanAmountRange").max),
          parseInt(document.getElementById("loanAmountRange").step),
          (v) => formatAmountAbbr(v),
          6
        );
        createSliderTicks(
          "interestRateLabels",
          parseFloat(document.getElementById("interestRate").min),
          parseFloat(document.getElementById("interestRate").max),
          parseFloat(document.getElementById("interestRate").step),
          (v) => v + "%",
          6
        );
        createSliderTicks(
          "loanTenureLabels",
          parseInt(document.getElementById("loanTenure").min),
          parseInt(document.getElementById("loanTenure").max),
          parseInt(document.getElementById("loanTenure").step),
          (v) => v + " Yr",
          6
        );
        updateValues();
      };

      // Update slider labels on tab switch
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          // ...existing code...
          let config = loanConfigs[currentLoanType];
          createSliderTicks(
            "loanAmountLabels",
            config.min,
            config.max,
            config.step,
            (v) => formatAmountAbbr(v),
            6
          );
        });
      });
    </script>
  </body>
</html>
